\chapter{Verwendete Methodiken}
Nach der Einführung zu den verschieden Themenbereichen, nur zu den eigentlichen Methodiken, welche entweder schon vorhanden sind, oder im Zuge dieser Arbeit erarbeitet wurden.
\section{Ladeservice und Ladeprozess}
Ein Ladeservice startet wenn sich ein Elektrofahrzeug mit einem passendem Ladegerät verbindet und endet wenn eben diese Verbindung wieder getrennt wird. Während dieser Zeit soll der Ladezustand des Fahrzeuges sich entweder auf 100\% erhöhen, oder wenn dies, aufgrund von zeitlichen oder technischen Limitierungen nicht möglich ist, möglichst nahen an 100\% annähern. Die Erhöhung des Ladezustands geschieht durch Ladevorgänge. Eine Ladeservice kann mehrere Ladevorgänge beinhalten. Ein Ladevorgang ist zeitlich unbeschränkt und endet wegen technischen Limitierungen oder wenn der Ladeservice, welcher den Ladevorgang enthält, endet. Technische Limitierung welche das Ende eines Ladeprozesses verursachen sind das nicht einhalten von Schwellenwerten in Hinsicht auf Spannung, Ladezustand des Fahrzeuges und Belastungen im Stromnetz. Im Ladevorgang selbst werden Geräte verwendet, welche elektrischen Strom benötigen, wenn dieser Strom nicht bei ausreichender Spannung vorliegt, muss der Ladevorgang abgebrochen werden. Ein Elektrofahrzeug kann keinen Ladezustand von mehr als 100\% aufweisen, werden bei einem Ladevorgang 100\% Ladezustand erreicht werden, endet der Ladevorgang. Bei einer zu hohen Belastung am Stromnetz wird im Sinne der Materialschonung der Ladevorgang beendet.Die Beendigung eines Ladevorgangs ist nicht gleichzusetzen mit dem Ende des Ladeservice an sich. Die bloße Anzahl von Ladevorgängen in einem Ladeservice mindert potenziell nicht die Qualität des Services. Die Qualität des Ladeservices hängt von Ladezustand des Elektrofahrzeuges bei Beendigung des Ladeservices ab. Je geringer der Abstand zu einem Ladezustand von 100\% desto höher ist die Qualität eines Ladeservice.
\section{Verwendbare Daten}
\label{cap:background_sec:setting}
Während eines Ladeservices kann für die Beurteilung der aktuellen Situation auf verschiedene Daten zugegriffen werden. Es ist die Ankunftszeit, also der Beginn des Ladeservices, bekannt, ebenso wie die Abfahrtszeit, welche das Ende des Ladeservices markiert. Neben der Anfangs- und Endzeit, ist auch der aktuelle Zeitpunkt bekannt. Die aktuellezeit erhöht sich periodisch um immer den selben Wert und kann so in diskrete Zeiteinheiten eingeteilt werden. Des weiteren ist in jedem Zeitpunkt des Ladeservices der Ladezustand des Fahrzeuges, die aktuelle Spannung am Anschlusspunkt und die maximale nutzbare Stromstärke des Fahrzeuges des jeweilgen Teilnehmers bekannt. Über ein Broadcastsystem wird innerhalb eines Anschlussbereiches von jedem Teilnehmer, welcher aktuell einen Ladeservice durchführt, die Informations das ein solcher Prozess stattfindet verteilt. Über das selbe Broadcastsystem wird von den Transformatoren des Anschlussbereiches die aktuelle Menge an Scheinleistung, welche in den Anschlussbereich abgegeben wird verteilt. Durch Sammlung der Meldungen von Fahrzeugen, welche gerade einen Ladeservice durchführen, lässt sich die Anzahl der aktuell stattfindenden Ladeservices im Anschlussbereich ermitteln.

\section{Spannungsregler nach VDE 4100}
\label{capBody:VDE}
Die erste Methodik dient als Grundlinie für den Vergleich der später folgenden Methodiken. Diese Methodik stellt die aktuell im Stromnetz vorliegende Situation dar. Sie verwendet die technische Anschlussregel Niederspannung (VDE-AR-N 4100), diese stellt neue Anforderungen an die Ladegeräte von Elektrofahrzeugen. Sie wurde ebenfalls entwickelt, um eine größere Anzahl von Ladegeräten am Netz nutzbar zu machen (VDE-quelle). Bei der verwendeten Form der Anschlussregel, handelt es sich um einen Spannungsregulator, welcher anhand der Spannung angibt, wie viel der aktuell möglichen Leistung abgerufen wird. Bei einem gemessenen Wert der Spannung von mehr als 93\% der Normspannung, kann die Leistung wie gefordert abgerufen werden. Ab einer Spannung von weniger als 88\% der Normspannung kann keine Leistung mehr angerufen werden. In dem Bereich von 93\% bis 88\% der Normspannung wird die abrufbare Leistung linear reduziert, von voller hin zu keiner abrufbaren Leistung.

\begin{figure}[tb]
	\includegraphics[width=\linewidth]{img/VDE2.png}
	\caption{Spannungs zu Leistungsverhältnis nach VDE-AR-N 4100}
	\label{Abb_VDEController}
\end{figure}

Der Graph in Abbildung \ref{Abb_VDEController} zeigt die mögliche Ladeleistung bei dem prozentualen Anteil der Normspannung. Auf der Y-Achse ist die mögliche Ladeleistung angetragen, wobei die eins für die höchstmögliche Leistung steht und null dafür, dass für keine Leistung abrufbar ist. An der X-Achse werden die aktuell anliegenden Prozent der Normspannung angetragen. An dem Graphen ist ersichtlich, dass bei mehr als 93\% der Normspannung die ganze Ladeleistung zur Verfügung steht. Es ist weiterhin erkennbar, wie sich die mögliche Ladeleistung im Bereich von 93\% bis 88\% der Normspannung verhält. Ebenso, wie das keine Ladeleistung bei einem Wert von weniger als 88\% der Normspannung mehr möglich ist. \\
Die Ladeleistung wird berechnet durch die Formel
\begin{align}
	Ladeleistung = Aktuelle\ Spannung \cdot maximal \label{Main_formula1}\\
	nutzbare\ Stromst\ddot{a}rke\ des\ Fahrzeuges \nonumber
\end{align}
Bei der Formel \ref{Main_formula1} wird von einer Spannung von über 93\% der Normspannung ausgegangen, da die berechnete Ladeleistung nicht verändert wird. Im Bereich von 93\% bis 88\% der Normspannung ist eine solche Änderung aber nötig. Der Faktor F, mit dem der verbliebene Anteil der möglichen Ladeleistung bestimmt wird, wird mit der Formel \\
\begin{align}
	F = 20 \cdot \frac{aktuelle Spannung}{Normspannung} - 17.6
	\label{Main_formula2}
\end{align}
Berechnet. Der Wertebereich der Formel ist bei null bzw. Eins abgeschlossen. Bei zu niedrigen Spannungswerten, weniger als 88\% der Normspannung, wird der Faktor ohne Berechnung der Formel mit null angegeben. Ergebnisse größer als eins werden auf eins reduziert, da alle Werte größer als eins in einer höheren Ladeleistung als überhaupt möglich resultieren würden. Wird nun der Faktor in Formel \ref{Main_formula1} berücksichtigt, ergibt sich folgende Formel für die mögliche Ladeleistung
\begin{align}
	Ladeleistung = Aktuelle\ Spannung \cdot maximal\ \label{Main_formula3}\\
	nutzbare\ Stromst\ddot{a}rke des\ Fahrzeuges \cdot Faktor \nonumber
\end{align}
Bevor die berechnete mögliche Ladeleistung allerdings tatsächlich bezogen wird, wird der Wert mithilfe eines First-Order Lag Filters gefiltert. Bei einem First-Order Lag Filter wird eine Änderung zwischen dem aktuellen und einem neu berechneten Wert nicht komplett vollzogen, sondern nur teilweise. Ein solcher Filter dient der Dämpfung großer Änderungen und soll kleiner Änderungen fast unverändert lassen. In der hier verwendeten Form werden nur 63,2\% der eigentlichen Änderung vorgenommen. So steigen Werte nur um 63,2\% der eigentlichen Steigerung, ebenso fallen Werte nur um 63,2\% der Änderung.
\begin{figure}[htb]
	\includegraphics[scale=0.75]{img/lag_Filter.png}
	\caption{Wirkung eines First-Order Lag Filters}
	\label{Abb_lag_filter}
\end{figure}

Aus der Abbildung \ref{Abb_lag_filter} wird ersichtlich, wie ein First-Order Lag Filter auf ein starkes Wachstum eines Wertes reagiert. Die durchgezogene Linie, welche beim Zeitpunkt null auf einen Wert von eins steigt, zeigt den Verlauf ohne Filter. Die gestrichelte Linie, welche im Zeitpunkt null beginnt, zeigt den Verlauf mit Filter. T\textsubscript{F} zeigt die Dauer des verwendeten Zeitintervalls. Die schwarzen Linie, beginned bei einem Wert von zwanzig auf der X-Achse, markieren an ihrem Schnittpunkt  mit der gestrichelten Linie den Wert nach der ersten Anwendung des Filters. Dieser Wert liegt bei 63,2\% der eigentlichen Änderung. Bei fortlaufender Zeit nähert sich die gestrichelte Linie der durchgezogen Linie immer weiter an.

\section{Fairere Spannungsregler}
Bei den nächsten vorgestellten Methoden wurden Bestandteile des Slotted Aloha Protokolls (Kapitel \ref{capBack:Aloha}) verwendet. Das Slotted Aloha Protokoll arbeitet auf einem geteilten Medium, welches von allen Teilnehmern verwendet wird. Dieses geteilte Medium ist in diesem Fall das in Kapitel \ref{capBack:Stromnetz} vorgestellte Niederspannungsnetz mit den dazugehörigen elektrischen Leitern. Ein Frame des Aloha Protokolls entspricht der Leistung die für die einzelnen Teilnehmer über das Stromnetz verteilt wird. Eine Kollision tritt immer dann auf, wenn die Spannung bei einem einzelnen Teilnehmer zu niedrig wird oder die Last am Transformator des Netzes zu hoch wird. Ob und wie nun auf die verschiedenen Arten der Kollisionen reagiert wird, hängt von der verwendeten Methodik ab.
\subsection{Wartezeit über Teilnehmerzahl}
\label{cap:background_sec:SA_participants}
Der in Kapitel \ref{capBody:VDE} vorgestellte Spannungsregler wird um die Behandlung von lokalen Spannungskollisionen, welche bei jedem Teilnehmer individuell passieren können, erweitert. Eine Spannungskollision tritt immer dann auf, wenn der Wert der lokal gemessen Spannung auf unter 88\% der Normspannung fällt. Fällt die Spannung auf einen solch niedrigen Wert kann gemäß dem Spannungsregler keine Leistung mehr aus dem Netz bezogen werden, bis die Spannung wieder auf einen Wert von über 88\% der Normspannung steigt. Ist eine Spannungskollision aufgetreten, wird, geregelt durch den Spannungsregler, keine Leistung mehr aus dem Netz bezogen und eine Wartezeit bestimmt. Diese Wartezeit gibt an, wie lange der Teilnehmer nicht mehr versucht Leistung aus dem Netz zu beziehen. Diese Wartezeit wird auch eingehalten, wenn die gemessen Spannungswerte eigentlich wieder einen Leistungsbezug möglich machen würden. Der Wert der Wartezeit werden per Zufall aus einem Intervall heraus bestimmt, unter Verwendung einer gleichverteilten Zufallsfunktion. Das Intervall ist nach unten sowie oben begrenzt. Die untere Grenze ist die Null, was keiner Wartezeit entspricht. Die obere Grenze wird primär durch die aktuelle Anzahl an Teilnehmer bestimmt. Ein Sonderfall tritt ein, wenn die Menge der Teilnehmer zahlenmäßig höher ist als die Anzahl der Zeiteinheiten zwischen dem aktuellen Zeitpunkt und dem Zeitpunkt an dem das Fahrzeug die Ladestation wieder verlässt. Wenn dieser Fall eintritt, wird das Intervall, aus welchem die Zufallszahl heraus bestimmt wird, nicht von der Anzahl der Teilnehmer nach oben hin begrenzt. Die obere Grenze des Intervalls entspricht dann der Anzahl von Zeiteinheiten zwischen dem aktuellen Zeitpunkt und dem Zeitpunkt an dem das Fahrzeug die Ladestation wieder verlässt. Es besteht die Möglichkeit, dass wenn die Wartezeit abgelaufen ist wieder oder immer noch eine Spannungskollision vorliegt. Tritt dies ein, wird wieder eine Wartezeit bestimmt, es gibt keine Möglichkeit für eine Sonderbehandlung bzw eine minimale Ladezeit nach einer Wartezeit. Diese hier vorgestellte Methodik wurde nur um Funktionalität für Spannungskollisionen erweitert. Wenn eine zu hohe Last vom Transformator abgerufen wird, werden bei dieser Methodik allerdings keine Maßnahmen ergriffen.
\begin{figure}[htb]
	\includegraphics[width = \linewidth]{img/SA_participants_Graph2.png}
	\caption{Graph}
	\label{SAPart:Graph}
\end{figure}

\subsection{Wartezeit über Teilnehmer und Fahrzeugparameter}
Ähnlich zu dem Vorgehen in Kapitel \ref{cap:background_sec:SA_participants} wird auch bei diesem Ansatz der in Kapitel \ref{capBody:VDE} vorgestellte Spannungsregler erweitert. Auch bei diesem Ansatz werden lediglich Spannungskollisionen betrachtet und es werden keine aktiven Maßnahmen bei einer zu hohen Last am Transformator ergriffen. Der Unterschied zu dem im kapitel \ref{cap:background_sec:SA_participants} vorgestellten Ansatz ist die Art und Weise der Berechnung der Wartezeit. Diese Wartezeit gibt an, wie lange der Teilnehmer nicht mehr versucht Leistung aus dem Netz zu beziehen. Diese Wartezeit wird auch eingehalten, wenn die gemessenen Spannungswerte eigentlich wieder einen Leistungsbezug möglich machen würden. Der Wert der Wartezeit werden per Zufall aus einem Intervall heraus bestimmt, unter Verwendung eines Mersenne-Twister(python-random). Das Intervall ist nach unten sowie oben begrenzt. Die untere Grenze ist die Null, was keiner Wartezeit entspricht. Die obere Grenze wird durch Ausführung einer Formel bestimmt, welche von drei Parametern abhängt.  Der erste Parameter gibt an wie viele Zeiteinheiten, zwischen dem aktuellen Zeitpunkt und dem Zeitpunkt, an dem das Fahrzeug die Ladestation wieder verlässt, liegen. Dieser Parameter wird im Folgenden mit ‚verbleibender Zeit‘ bezeichnet. Der zweite Parameter gibt an, wie viel Zeit noch benötigt wird, um den Akku des Fahrzeuges auf einen Ladestand von 100\% zu bringen. Für diese Berechnung wird allerdings die Normspannung verwendet und nicht die aktuell gemessene Spannung. Dieser Parameter wird im Folgenden mit ‚verbleibender Ladezeit‘ bezeichnet. Die beiden Parameter, verbleibende Zeit und verbleibende Ladezeit, werden lokal von jedem Teilnehmer für sich selbst bestimmt, sie benötigen dafür keinen weiteren Input. Der dritte Parameter ist die aktuelle Anzahl an Teilnehmenden. Diese drei Parameter, die verbleibende Zeit, die verbleibende Ladezeit und die Anzahl der Teilnehmer werden in folgende Formel eingesetzt:
\begin{align}
	obere \ Grenze = \frac{verbleibende\ Zeit - verbleibende\ Ladezeit}{Anzahl\ der\ Teilnehmer}
	\label{SA:formel4}
\end{align}
Der Ergnisbereich der Formel \ref{SA:formel4} ist nach oben durch den faktor 'verbleibende Zeit - verbleibende Ladezeit' begrenzt und nach unten aufgrund der Division des Faktors durch minus unendlich. Das Ergebnis dieser Formel beschränkt nun das Intervall, aus dem die Wartezeit bestimmt wird, nach oben. Ein Sonderfall tritt auf, wenn das Ergebnis dieser Formel kleiner ist als eins. Dies kann passieren, wenn etwa die verbleibende Zeit geringer ist als die verbleibende Ladezeit. Tritt dieser Fall ein wird erneut eine obere Grenze für das Intervall bestimmt. Die Formel, die in diesem Fall verwendet wird, hat nur einen Parameter. Dieser Parameter ist die zuvor berechnete obere Grenze des Intervalls, genannt 'alte Grenze'. Zur Bestimmung des neuen Wertes wird folgende Formel verwendet
\begin{align}
	obere\ Grenze = 10 \cdot (1 - e^{alte\ Grenze - 1}) + 1
	\label{SA-formel5}
\end{align}
Der Parameter der Formel \ref{SA-formel5} liegt im bereich von minus unendlich bis eins. Die Formel wurde entwickelt mit dem Ziel Werte zwischen eins und elf zu liefern, wobei sich eine anfängliche Differenzierung der Ergebnisse bei kleiner werden Werten des Parameters einstellen sollte. Das Ergebnis dieser Formel grenzt nun das Intervall, aus dem die Wartezeit bestimmt wird, nach oben ab. Das Verhalten während einer Wartezeit, welche mithilfe dieser Formel \ref{SA-formel5} abgegrenzt wurde, kann sich von dem Verhalten einer Wartezeit welche durch Formel \ref{SA:formel4} abgegrenzt wird unterscheiden. Wenn eine solche Wartezeit das erste Mal bestimmt wird, unterscheidet sich das Verhalten in drei Punkten. Der Erste wäre, dass die Verbindung zum Netz nicht getrennt wird, es wird also weiterhin Leistung aus dem Netz bezogen. Der zweite Unterschied liegt in der Bestimmung der möglichen Ladeleistung, statt mit der Formel \ref{Main_formula3} wird, entgegen dem eigentlich verwendetem Spannungsregler, die Formel \ref{Main_formula1} verwendet. Der dritte Unterschied ist das veränderte Verhalten beim Auftreten von Kollisionen, diese werden nicht beachtet und es wird nicht auf sie reagiert. Eine solche Art der Wartezeit kann allerdings nicht mehrmals direkt hintereinander wahrgenommen werden. Tritt nach Beendigung dieser Wartezeit sofort wieder eine Kollision auf, muss eine normale Wartezeit abgewartet werden, auch wenn das Intervall mithilfe der Formel \ref{SA-formel5} begrenzt wurde. Nach dieser Wartezeit ist eine solche Sonderbehandlung allerdings wieder möglich.
\begin{figure}[htb]
	\includegraphics[width = \linewidth]{img/SA_waiting_Graph3.png}
	\caption{Graph}
	\label{SAWait:Graph}
\end{figure}
\begin{figure}[htb]
	\includegraphics[width=\linewidth]{img/dia1.png}
	\caption{Diagram}
	\label{dia1}
\end{figure}

